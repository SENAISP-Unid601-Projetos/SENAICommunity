<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content"
    />
    <title>SENAI Community | Mensagens</title>
    <link
      rel="icon"
      href="img/LogoFavicon-removebg-preview.png2.png"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="Principal/CSS/principal.css" />
    <link rel="stylesheet" href="Mensagem/CSS/mensagem.css" />
  </head>

  <body>
    <div class="notification-center"></div>

    <div class="mobile-overlay" id="mobile-overlay"></div>

    <header class="topbar">
      <div class="header-left">
        <div class="menu-toggle" id="mobile-menu-toggle">
          <i class="fas fa-bars"></i>
        </div>
        <h1 class="logo"><span class="highlight">SENAI </span>Community</h1>
      </div>
      <div class="search">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Pesquisar projetos..." />
      </div>
      <nav class="nav-icons">
        <div
          class="nav-icon"
          data-tooltip="Notificações"
          id="notifications-icon"
        >
          <i class="fas fa-bell"></i>
          <span class="badge" id="notifications-badge" style="display: none"
            >0</span
          >
          <div class="notifications-panel" id="notifications-panel">
            <div class="notifications-header">
              <h3>Notificações</h3>
            </div>
            <div class="notifications-list" id="notifications-list">
              <p class="empty-state">Nenhuma notificação nova.</p>
            </div>
          </div>
        </div>
        <div class="theme-toggle" data-tooltip="Alternar tema">
          <i class="fas fa-moon"></i>
        </div>
      </nav>
      <div class="user-dropdown">
        <div class="user">
          <div class="profile-pic">
            <img
              src="https://via.placeholder.com/40"
              alt="Perfil"
              id="topbar-user-img"
            />
          </div>
          <span id="topbar-user-name">Carregando...</span>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="dropdown-menu">
          <a href="#" id="edit-profile-btn"
            ><i class="fas fa-user"></i> Meu Perfil</a
          >
          <a href="configuracao.html"
            ><i class="fas fa-cog"></i> Configurações</a
          >
          <a href="#" id="logout-btn"
            ><i class="fas fa-sign-out-alt"></i> Sair</a
          >
        </div>
      </div>
    </header>

    <div class="container">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-user-card">
            <a href="perfil.html" class="user-info-link">
              <div class="user-info">
                <div class="user-info-loading" id="user-info-loading">
                  <div class="loading-spinner"></div>
                </div>

                <div class="avatar-container">
                  <img
                    src="https://via.placeholder.com/80"
                    alt="Perfil"
                    id="sidebar-user-img"
                  />
                  <div class="status online"></div>
                </div>

                <div class="user-identity">
                  <h2 id="sidebar-user-name">Carregando...</h2>
                  <span class="user-role" id="sidebar-user-title"
                    >Carregando...</span
                  >
                </div>

                <div class="user-stats">
                  <div class="stat-item">
                    <strong id="connections-count">-</strong>
                    <span class="stat-label">Conexões</span>
                  </div>
                  <div class="stat-item">
                    <strong id="projects-count">-</strong>
                    <span class="stat-label">Projetos</span>
                  </div>
                </div>
              </div>
            </a>
          </div>
          <button class="sidebar-close" id="sidebar-close">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <nav class="sidebar-menu">
          <a href="principal.html" class="menu-item">
            <i class="fas fa-home"></i>
            <span class="menu-text">Feed</span>
          </a>
          <a href="mensagem.html" class="menu-item active">
            <i class="fas fa-comment-dots"></i>
            <span class="menu-text">Mensagens</span>
            <span class="badge" id="message-badge-sidebar" style="display: none"
              >0</span
            >
          </a>
          <a href="projeto.html" class="menu-item">
            <i class="fas fa-users"></i>
            <span class="menu-text">Projetos</span>
          </a>
          <a href="vaga.html" class="menu-item">
            <i class="fas fa-briefcase"></i>
            <span class="menu-text">Vagas</span>
          </a>
          <a href="evento.html" class="menu-item">
            <i class="fas fa-calendar-check"></i>
            <span class="menu-text">Eventos</span>
          </a>
          <a href="buscar_amigos.html" class="menu-item">
            <i class="fas fa-user-plus"></i>
            <span class="menu-text">Encontrar Pessoas</span>
          </a>
          <a href="amizades.html" class="menu-item">
            <i class="fas fa-user-friends"></i>
            <span class="menu-text">Minhas Conexões</span>
          </a>
        </nav>

        <div class="sidebar-widget">
          <div class="widget-card online-friends" id="online-friends-widget">
            <h3 class="widget-title">Amigos Online</h3>
            <div class="friend-list" id="online-friends-list">
              <div class="results-loading" style="padding: 1rem">
                <div class="loading-spinner"></div>
                <p style="font-size: 0.8rem; margin-top: 0.5rem">
                  Carregando...
                </p>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <main class="main-content">
        <div class="chat-container" id="chat-container">
          <aside class="chat-sidebar" id="chat-sidebar-area">
            <div class="sidebar-header">
              <h2>Mensagens</h2>

              <div class="chat-sidebar-actions" style="display: flex; gap: 8px">
                <button
                  class="blocked-users-btn"
                  id="open-blocked-modal-btn"
                  title="Usuários Bloqueados"
                  style="
                    background: var(--bg-tertiary);
                    border: 1px solid var(--border-color);
                    color: var(--text-secondary);
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s;
                  "
                >
                  <i class="fas fa-user-slash" style="font-size: 0.9rem"></i>
                </button>

                <button
                  class="add-convo-btn"
                  title="Nova Conversa"
                  style="width: 36px; height: 36px; font-size: 1rem"
                >
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>

            <div class="sidebar-search">
              <input
                type="text"
                id="convo-search"
                placeholder="Buscar conversas..."
              />
              <i class="fas fa-search"></i>
            </div>
            <div class="conversations-list" id="conversations-list"></div>
          </aside>

          <main class="chat-main" id="chat-main-area">
            <div class="chat-card">
              <div id="chat-header-area" class="chat-header-area">
                <button id="back-to-list-btn" class="back-to-list-btn">
                  <i class="fas fa-arrow-left"></i>
                </button>

                <div id="chat-header-content" class="chat-header-content"></div>

                <div class="chat-options-dropdown">
                  <div class="dropdown-content" id="chat-options-menu">
                    <a href="#" id="opt-block-user"
                      ><i class="fas fa-ban"></i> <span>Bloquear</span></a
                    >
                    <a href="#" id="opt-delete-chat" class="text-danger"
                      ><i class="fas fa-trash"></i> Excluir Conversa</a
                    >
                  </div>
                </div>
              </div>
              <div class="chat-messages-area" id="chat-messages-area">
                <div class="empty-chat">
                  Selecione uma conversa para começar.
                </div>
              </div>
              <form class="chat-input-area" id="chat-form" autocomplete="off">
                <button
                  type="button"
                  id="record-audio-btn"
                  class="chat-action-btn"
                  disabled
                >
                  <i class="fas fa-microphone"></i>
                </button>
                <input
                  type="text"
                  id="chat-input"
                  placeholder="Digite uma mensagem..."
                  autocomplete="off"
                  disabled
                />
                <button type="submit" id="chat-send-btn" disabled>
                  <i class="fas fa-paper-plane"></i>
                </button>
              </form>
            </div>
          </main>
        </div>
      </main>

      <aside class="right-sidebar">
        <div class="widget-card" id="upcoming-events-widget"></div>
        <div class="widget-card" id="who-to-follow-widget"></div>
      </aside>
    </div>

    <div class="modal-overlay" id="add-convo-modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Nova Conversa</h2>
          <button class="close-modal-btn" id="close-modal-btn">&times;</button>
        </div>
        <div class="modal-body">
          <input
            type="text"
            id="user-search-input"
            placeholder="Buscar usuário..."
          />
          <div class="user-list" id="new-convo-user-list"></div>
        </div>
      </div>
    </div>

    <div id="edit-profile-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Editar Perfil</h3>
        </div>
        <form id="edit-profile-form">
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              id="cancel-edit-profile-btn"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">Salvar</button>
          </div>
        </form>
      </div>
    </div>
    <div id="delete-account-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Excluir Conta</h3>
        </div>
        <form id="delete-account-form">
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              id="cancel-delete-account-btn"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-danger">Excluir</button>
          </div>
        </form>
      </div>
    </div>

    <div id="custom-edit-modal" class="custom-modal-overlay">
      <div class="custom-modal-box">
        <div class="custom-modal-header">
          <h3><i class="fas fa-pen"></i> Editar Mensagem</h3>
        </div>
        <div class="custom-modal-body">
          <textarea
            id="custom-edit-input"
            placeholder="Digite a nova mensagem..."
          ></textarea>
        </div>
        <div class="custom-modal-footer">
          <button id="btn-cancel-edit" class="btn-modal btn-ghost">
            Cancelar
          </button>
          <button id="btn-confirm-edit" class="btn-modal btn-primary">
            Salvar Alterações
          </button>
        </div>
      </div>
    </div>

    <div id="custom-delete-modal" class="custom-modal-overlay">
      <div class="custom-modal-box">
        <div class="custom-modal-header">
          <h3 class="text-danger">
            <i class="fas fa-exclamation-triangle"></i> Excluir Mensagem
          </h3>
        </div>
        <div class="custom-modal-body">
          <p>
            Tem certeza que deseja apagar esta mensagem? Esta ação não pode ser
            desfeita.
          </p>
        </div>
        <div class="custom-modal-footer">
          <button id="btn-cancel-delete" class="btn-modal btn-ghost">
            Cancelar
          </button>
          <button id="btn-confirm-delete" class="btn-modal btn-danger">
            Sim, Excluir
          </button>
        </div>
      </div>
    </div>

    <div id="custom-delete-chat-modal" class="custom-modal-overlay">
      <div class="custom-modal-box">
        <div class="custom-modal-header">
          <h3 class="text-danger">
            <i class="fas fa-trash-alt"></i> Apagar Histórico?
          </h3>
        </div>
        <div class="custom-modal-body">
          <p>
            Isso apagará todas as mensagens desta conversa permanentemente para
            ambos. Deseja continuar?
          </p>
        </div>
        <div class="custom-modal-footer">
          <button id="btn-cancel-chat-delete" class="btn-modal btn-ghost">
            Cancelar
          </button>
          <button id="btn-confirm-chat-delete" class="btn-modal btn-danger">
            Sim, Apagar Tudo
          </button>
        </div>
      </div>
    </div>

    <div id="blocked-users-modal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-user-slash"></i> Contatos Bloqueados</h3>
          <button class="close-modal-btn" id="close-blocked-modal-btn">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div
            id="blocked-users-list"
            class="user-list"
            style="
              max-height: 300px;
              overflow-y: auto;
              display: flex;
              flex-direction: column;
              gap: 10px;
            "
          >
            <p style="text-align: center; color: var(--text-secondary)">
              Carregando...
            </p>
          </div>
        </div>
      </div>
    </div>

    <div id="custom-block-user-modal" class="custom-modal-overlay">
      <div class="custom-modal-box">
        <div class="custom-modal-header">
          <h3 class="text-danger">
            <i class="fas fa-user-slash"></i> Bloquear Usuário?
          </h3>
        </div>
        <div class="custom-modal-body">
          <p>
            Você não receberá mais mensagens deste usuário. A conversa será
            ocultada da sua lista.
          </p>
        </div>
        <div class="custom-modal-footer">
          <button id="btn-cancel-block" class="btn-modal btn-ghost">
            Cancelar
          </button>
          <button id="btn-confirm-block" class="btn-modal btn-danger">
            Sim, Bloquear
          </button>
        </div>
      </div>
    </div>

    <div id="custom-delete-chat-modal" class="custom-modal-overlay">
      <div class="custom-modal-box">
        <div class="custom-modal-header">
          <h3 class="text-danger">
            <i class="fas fa-trash-alt"></i> Apagar Conversa?
          </h3>
        </div>
        <div class="custom-modal-body">
          <p>
            Isso apagará todo o histórico de mensagens desta conversa
            permanentemente. Deseja continuar?
          </p>
        </div>
        <div class="custom-modal-footer">
          <button id="btn-cancel-chat-delete" class="btn-modal btn-ghost">
            Cancelar
          </button>
          <button id="btn-confirm-chat-delete" class="btn-modal btn-danger">
            Sim, Apagar Tudo
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="Principal/JS/principal.js"></script>
    <script src="Mensagem/JS/mensagem.js"></script>
  </body>
</html>
